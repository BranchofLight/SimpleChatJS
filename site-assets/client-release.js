$(document).ready(function(){var a=io(),b="";$("#usr-form").on("submit",function(c){var d=$("#usr-box");confirmInput(d.val())&&(b=sanitizeInput(d.val()),a.emit("usr-req",b),console.log("Sent request for username: "+b)),c.preventDefault()}),$("#msg-form").on("submit",function(c){var d=$("#msg-box");confirmInput(d.val())&&(a.emit("msg-sent",b,d.val()),console.log("Sent message: "+d.val()),addMessage(b,d.val())),d.val(""),console.log("User is no longer typing"),a.emit("usr-not-typing",b),removeIsTyping(b),c.preventDefault()}),$("#msg-box").on("input",function(){confirmInput($("#msg-box").val())?(console.log("User is typing"),a.emit("usr-typing",b),addIsTyping(b)):(console.log("User is no longer typing"),a.emit("usr-not-typing",b),removeIsTyping(b))}),a.on("usr-typing",function(a){console.log("Attempting to add 'is typing' status: "+a),addIsTyping(a)}),a.on("usr-not-typing",function(a){console.log("Attempting to remove 'is typing' status: "+a),removeIsTyping(a)}),a.on("msg-sent",function(a,b){console.log("Received message: "+b),addMessage(a,b)}),a.on("usr-req",function(a){if(console.log("Receiving data about a user request."),a.accept){if(console.log("Username accepted: "+a.username),addUsername(a.username),addServerMsg(a.username+" connected."),b===a.username){$("#land-overlay").remove();var c=31536e4;$.cookie("username",a.username,{expires:c,path:"/"})}}else{console.log("Username rejected: "+a.username);var d;$("#username-input #err").length?$("#username-input #err").fadeOut("fast",function(){$("#username-input #err").remove(),console.log("Reason: "+a.reason),d="len"===a.reason?"username must be less than 14 characters.":"username already taken.",$("#username-input").append('<p id="err">Error: '+d+"</p>"),$("#username-input #err").fadeIn("fast")}):(console.log("Reason: "+a.reason),d="len"===a.reason?"username must be less than 14 characters.":"username already taken.",$("#username-input").append('<p id="err">Error: '+d+"</p>"))}}),a.on("all-users",function(a){for(var b=0;b<a.length;++b)addUsername(a[b])}),a.on("user-left",function(a){console.log("A user left. Updating.");var b=findUserHTML(a);void 0!==b&&(console.log("Removing user: "+b.text()),addServerMsg(a+" disconnected."),b.remove())}),a.on("cookie-usr",function(a){console.log("Cookie username found."),$("#usr-box").val(a)})});var findUserHTML=function(a){var b;return $("#users-area").children().each(function(){return $(this).text()===a?(b=$(this),!1):void 0}),b},addMessage=function(a,b){b=sanitizeInput(b),$("#message-area").append("<li>"+a+": "+b+"</li>"),$("#message-area").animate({scrollTop:$("#message-area").prop("scrollHeight")})},addServerMsg=function(a){$("#message-area").append('<li class="server-msg">Server: '+a+"</li>"),$("#message-area").animate({scrollTop:$("#message-area").prop("scrollHeight")})},addUsername=function(a){$("#users-area").append("<li>"+a+"</li>")},sanitizeInput=function(a){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(a.replace(/[&<>"'`=\/]/g,function(a){return b[a]}))},confirmInput=function(a){for(var b in a)if(" "!==a[b])return!0;return!1},addIsTyping=function(a){var b=findUserHTML(a);void 0!==b&&b.html(b.text()+'<span class="typing">is typing</span>')},removeIsTyping=function(a){var b=findUserHTML(a+"is typing");void 0!==b&&b.text(b.text().replace("is typing",""))};